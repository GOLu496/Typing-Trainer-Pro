<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Current Affairs Reader</title>
    <style>
        :root {
            --bg: #111111;
            --card-bg: #1e1e1e;
            --text-main: #e0e0e0;
            --text-sec: #a0a0a0;
            --accent: #4dabf7;
            --accent-hover: #339af0;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg);
            color: var(--text-main);
            font-family: 'Merriweather', serif; /* Good for reading */
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* Top Bar */
        .navbar {
            width: 100%;
            padding: 15px 0;
            background-color: #181818;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: center;
            gap: 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .btn {
            background-color: #2c2c2c;
            color: #fff;
            border: 1px solid #444;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-family: sans-serif;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: 0.2s;
        }

        .btn:hover { background-color: #383838; border-color: var(--accent); }
        .btn.active { background-color: var(--accent); border-color: var(--accent); color: #000; font-weight: bold; }
        
        /* Reader Container */
        .reader-container {
            max-width: 800px;
            width: 90%;
            margin-top: 30px;
            padding-bottom: 100px;
        }

        .news-card {
            background-color: var(--card-bg);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 1px solid #333;
            min-height: 400px;
            position: relative;
        }

        .meta-tag {
            background: #25262b;
            color: var(--accent);
            padding: 4px 12px;
            border-radius: 4px;
            font-family: sans-serif;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: inline-block;
            margin-bottom: 15px;
        }

        h1 {
            font-family: sans-serif;
            font-size: 2rem;
            line-height: 1.3;
            margin-top: 0;
            margin-bottom: 10px;
            color: #ffffff;
        }

        .date {
            color: var(--text-sec);
            font-family: sans-serif;
            font-size: 0.9rem;
            margin-bottom: 30px;
            border-bottom: 1px solid #333;
            padding-bottom: 20px;
        }

        .content {
            font-size: 1.15rem;
            line-height: 1.8;
            color: #d0d0d0;
            white-space: pre-wrap; /* Preserve paragraph spacing */
        }

        /* Bottom Controls */
        .footer-controls {
            position: fixed;
            bottom: 30px;
            background: rgba(30, 30, 30, 0.9);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            border-radius: 50px;
            border: 1px solid #444;
            display: flex;
            gap: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            z-index: 200;
        }

        .footer-btn {
            background: transparent;
            border: none;
            color: #fff;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: transform 0.2s;
        }
        .footer-btn:hover { transform: scale(1.1); color: var(--accent); }
        .next-btn { background: var(--accent); color: #000; border-radius: 30px; padding: 10px 30px; font-size: 1rem; font-weight: bold; }
        .next-btn:hover { background: var(--accent-hover); color: #fff; }

        /* Loading Overlay */
        .loading-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--card-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            border-radius: 12px;
        }
        .hidden { display: none !important; }

    </style>
</head>
<body>

    <div class="navbar">
        <a href="index.html" class="btn">üè† Home</a>
        <button id="lang-en" class="btn active" onclick="setLanguage('en')">English</button>
        <button id="lang-hi" class="btn" onclick="setLanguage('hi')">‡§π‡§ø‡§Ç‡§¶‡•Ä (Hindi)</button>
        <button id="speak-btn" class="btn" onclick="toggleSpeech()">üîä Listen</button>
    </div>

    <div class="reader-container">
        <div class="news-card">
            <div id="loading" class="loading-overlay">Loading News...</div>
            
            <div id="content-area">
                <span class="meta-tag">Current Affairs</span>
                <h1 id="news-title">Loading Headline...</h1>
                <div class="date" id="news-date">...</div>
                <div class="content" id="news-body">
                    Fetching latest data from server...
                </div>
            </div>
        </div>
    </div>

    <div class="footer-controls">
        <button class="footer-btn" onclick="prevNews()">‚¨ÖÔ∏è</button>
        <button class="next-btn" onclick="nextNews()">Next Article ‚û°Ô∏è</button>
    </div>

    <script>
        let articles = [];
        let currentIndex = 0;
        let currentLang = 'en'; // 'en' or 'hi'
        let isSpeaking = false;
        let speechUtterance = null;
        
        // --- 1. Fetch Data ---
        async function fetchNews() {
            try {
                const response = await fetch('2.json');
                if (!response.ok) throw new Error("Failed to load");
                const data = await response.json();
                
                // Filter valid articles
                articles = data.filter(item => item.content && item.content.length > 50);
                
                if (articles.length > 0) {
                    renderNews(0);
                    document.getElementById('loading').classList.add('hidden');
                } else {
                    document.getElementById('news-body').innerText = "No news available today.";
                    document.getElementById('loading').classList.add('hidden');
                }
            } catch (error) {
                console.error(error);
                document.getElementById('news-body').innerText = "Error loading news. Please check connection.";
                document.getElementById('loading').classList.add('hidden');
            }
        }

        // --- 2. Render News ---
        async function renderNews(index) {
            if (index < 0) index = articles.length - 1;
            if (index >= articles.length) index = 0;
            currentIndex = index;

            // Stop audio if playing
            stopSpeech();

            const article = articles[currentIndex];
            const loading = document.getElementById('loading');
            loading.classList.remove('hidden'); // Show loading while processing

            // Update Text content based on Language
            if (currentLang === 'hi') {
                // Translate Logic
                try {
                    const titleHi = await translateText(article.title, 'hi');
                    const contentHi = await translateText(article.content, 'hi');
                    updateUI(titleHi, article.date, contentHi);
                } catch (e) {
                    updateUI(article.title, article.date, "Translation failed. Showing English.\n\n" + article.content);
                }
            } else {
                // Default English
                updateUI(article.title, article.date, article.content);
            }
            
            loading.classList.add('hidden');
        }

        function updateUI(title, date, content) {
            document.getElementById('news-title').innerText = title;
            document.getElementById('news-date').innerText = "Date: " + date;
            document.getElementById('news-body').innerText = content;
        }

        // --- 3. Translation Helper (Google API Hack) ---
        async function translateText(text, targetLang) {
            // Using free Google Translate API endpoint (Lightweight usage only)
            // Note: This works for small texts. If content is huge, we might need to split it.
            // Truncate to 2000 chars to avoid errors in free API
            const safeText = text.substring(0, 2000); 
            const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=${targetLang}&dt=t&q=${encodeURI(safeText)}`;
            
            const res = await fetch(url);
            const data = await res.json();
            
            // Combine translated segments
            let translatedText = "";
            if (data && data[0]) {
                data[0].forEach(segment => {
                    translatedText += segment[0];
                });
            }
            return translatedText;
        }

        // --- 4. Language Switcher ---
        function setLanguage(lang) {
            if (currentLang === lang) return;
            currentLang = lang;

            // Update Button Styles
            document.getElementById('lang-en').classList.remove('active');
            document.getElementById('lang-hi').classList.remove('active');
            document.getElementById(`lang-${lang}`).classList.add('active');

            // Re-render current article
            renderNews(currentIndex);
        }

        // --- 5. Text-to-Speech ---
        function toggleSpeech() {
            if (isSpeaking) {
                stopSpeech();
            } else {
                const text = document.getElementById('news-body').innerText;
                const title = document.getElementById('news-title').innerText;
                const fullText = title + ". " + text;
                
                speechUtterance = new SpeechSynthesisUtterance(fullText);
                
                // Set Voice/Lang
                if (currentLang === 'hi') {
                    speechUtterance.lang = 'hi-IN';
                } else {
                    speechUtterance.lang = 'en-US';
                }

                speechUtterance.rate = 0.9; // Slightly slower for news reading
                
                speechUtterance.onend = () => {
                    isSpeaking = false;
                    document.getElementById('speak-btn').innerText = "üîä Listen";
                    document.getElementById('speak-btn').classList.remove('active');
                };

                window.speechSynthesis.speak(speechUtterance);
                isSpeaking = true;
                document.getElementById('speak-btn').innerText = "‚èπ Stop";
                document.getElementById('speak-btn').classList.add('active');
            }
        }

        function stopSpeech() {
            window.speechSynthesis.cancel();
            isSpeaking = false;
            document.getElementById('speak-btn').innerText = "üîä Listen";
            document.getElementById('speak-btn').classList.remove('active');
        }

        // --- 6. Navigation Controls ---
        function nextNews() {
            renderNews(currentIndex + 1);
        }
        function prevNews() {
            renderNews(currentIndex - 1);
        }

        // Initialize
        window.onload = fetchNews;

    </script>
</body>
</html>
