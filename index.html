<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Speed Pro</title>
    <link rel="icon" type="jpg" href="icon.jpg">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
.gradient-border-wrapper {
    position: relative;
    display: inline-block;
    padding: 5px;
    border-radius: 9999px;
    background: transparent;
    overflow: hidden;
}

.border-wrapper {
    position: relative;
    display: flex;
    padding: 3px;
    border-radius: 10px;
    background: transparent;
    overflow: hidden;
    width:100%;
}

.gradient-border-wrapper::before {
    content: "";
    position: absolute;
    right: -17px;
    top: -38px;
    insert: -50%;
    width: 150px;
    height: 150px;
    background: conic-gradient(
        #4285f4,
        #ea4335,
        #fbbc05,
        #34a853,
        #4285f4
    );
    animation: google-ring-spin 3s linear infinite;
}


.border-wrapper::before {
    content: "";
    position: absolute;
    right: -15%;
    top: -470px;
    insert: -50%;
    width: 130%;
    height: 700%;
    background: conic-gradient(
        #4285f4,
        #ea4335,
        #fbbc05,
        #34a853,
        #4285f4
    );
    animation: google-ring-spin 3s linear infinite;
}
.gradient-border-wrapper .inner-button {
    position: relative;
    z-index: 1;
    border: none;
    border-radius: 999px;
    padding: 10px 26px;
    background: #111;
    color: #fff;
    font-size: 1rem;
    cursor: pointer;
}


@keyframes google-ring-spin {
    0%    { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}


.border-wrapper .inner-button {
    position: relative;
    z-index: 1;
    border: none;
    border-radius: 10px;
    padding: 60px;
    background: #D1FFFF;
    color: black;
    font-size: 1.4em;
    cursor: pointer;
}


@keyframes google-ring-spin {
    0%    { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}


        body {
            font-family: 'Poppins', sans-serif;
            background-color: #424242;
            color: #333;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }


    .glow header {
            width: 85%;
            z-index: 2;
            text-align: center;
            border-radius: 12px;
            padding: 20px 0;
            background-color: #007bff;
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h1 { margin: 0; font-weight: 600; }

.glow {
    position: relative;
    display: inline-block;
    padding: 5px;
    border-radius: 9999px;

    background: transparent;
    overflow: hidden;
}

.glow::before {
    content: "";
    position: absolute;
    right: -670px;
    top: -190px;
    insert: -50%;
    width: 2700px;
    height: 2700px;
    background: conic-gradient(
        #4285f4,
        #ea4335,
        #fbbc05,
        #34a853,
        #4285f4
    );
    animation: google-ring-spin 3s linear infinite;
}
    .glow {
            display: flex;
            flex-direction: column;
            width: 100%;
            justify-content: center;
            align-items: center;
            margin-top: 0px;
            padding: 0px;
            background-color: red;
            border-radius: 0px;
            position: relative;
        }



        .container {
            width: 90%;
            max-width: 1100px;
            margin-top: 30px;
            margin-bottom: 30px;
            padding: 20px;
            background-color: #E3E3E3;
            border-radius: 12px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        .stats-panel {
            display: flex;
            justify-content: space-around;
            background-color: #A6D2FF;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 1.1em;
            font-weight: 500;
            border-left: 5px solid #007bff;
        }
        .stats-panel p { margin: 0; }
        .stats-panel span { font-weight: 700; color: #d9534f; }
        #net-wpm, #accuracy { color: #5cb85c; }


        .graph-container {
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 20px;
            height: 350px;
            background-color:#A6D2FF;
        }


        .typing-text-display {
            background-color: #ADFF5C;
            padding: 25px;
            border-radius: 8px;
            font-size: 1.4em;
            line-height: 1.8;
            margin-bottom: 20px;
            /* Single line settings */
            height: 2em; 
            overflow: hidden; 
            white-space: nowrap; 
            border: 2px solid #ccc;
            user-select: none;
            scroll-behavior: smooth; 
        }

        .typing-text-display span {
            display: inline-block;
        }

        .correct { color: #5cb85c; }
        .incorrect {
            background-color: #f2dede;
            color: #a94442;
            border-bottom: 1px dashed #a94442;
        }
        .current {
            background-color: #007bff40;
            border-right: 2px solid #007bff;
            animation: blink 1s step-start 0s infinite;
        }
        @keyframes blink { 50% { border-right-color: transparent; } }


        .text-input {
            width: 100%;
            height: 100px;
            padding: 15px;
            border: 2px solid #007bff;
            border-radius: 8px;
            font-size: 1.4em;
            resize: none;
            background-color: #A6D2FF;
            color: #333;
            box-sizing: border-box;
            outline: none;
            margin-bottom: 20px;
            transition: box-shadow 0.3s;
        }
        .text-input:focus { box-shadow: 0 0 10px rgba(0, 123, 255, 0.5); }

        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .controls select, .controls input[type="number"] {
            padding: 10px 18px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 1em;
            background-color: #A6D2FF;
            color: #333;
        }


        .loading-text { color: #007bff; font-style: italic; }


        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .popup-content {
            background: white;
            padding: 0px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 15px 25px rgba(0, 0, 0, 0.5);
            max-width: 90%;
            width: 746px;
            height: 430px;
            position: relative;
            overflow:hidden;
            transform: scale(0.9);
            transition: transform 0.3s ease-out;
        }
        .popup-content.show {
            transform: scale(1);
        }


        .popup-content h2 { color: #d9534f; font-size: 2.5em; margin-top: 0; }
        .popup-content .result-stats p { font-size: 1.2em; font-weight: 500; }
        .popup-content .result-stats span { font-weight: 700; color: #007bff; }
        .popup-content img { width: 80px; height: 80px; margin-bottom: 20px; }


        .countdown-number {
            font-size: 10em;
            font-weight: 900;
            color: #5cb85c;
            animation: pulse 1s ease-in-out infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 0.8; }
        }

        .popup-controls {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .popup-controls button {
            background-color: #5cb85c;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .popup-controls button:hover {
            background-color: #449d44;
        }
        .popup-time-select {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        .popup-time-select select, .popup-time-select input {
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 5px;
        }
    </style>
</head>
<body>



    <main class="glow" style="colour: blue;">

    <header>
        <h1>Typing Speed Pro</h1>
    </header>

<div class="container">
        <div class="stats-panel">
            <p>Net Speed: <span id="net-wpm">0</span> WPM</p>
            <p>Accuracy: <span id="accuracy">100</span>%</p>
            <p>Errors: <span id="errors-count">0</span></p>
            <p>Time Left: <span id="time-left">60</span>s</p>
        </div>

        <div class="graph-container">
            <h3>WPM Consistency (Per 5 seconds)</h3>
            <canvas id="wpm-chart"></canvas>
        </div>

        <div id="initial-controls" class="controls">
            <select id="time-select">
                <option value="60">1 Minute</option>
                <option value="180">3 Minutes</option>
                <option value="300">5 Minutes</option>
                </select>
            <input type="number" id="custom-time" min="10" max="600" value="60" placeholder="Custom Time (s)">

            <select id="lesson-mode">
                <option value="news">Dynamic News (Recommended)</option>
                <option value="standard">Static Paragraph</option>
                <option value="code">Code Syntax</option>
            </select>
            <div class="gradient-border-wrapper">
                <button <button id="initial-start-btn" class="inner-button" style="background-color: black;
    ">Start Test</button> </div>


</div>
        <div id="typing-text-display" class="typing-text-display loading-text">
            Loading Fresh Content... Please wait.
        </div>




<div class="border-wrapper">
        <textarea id="text-input" class="inner-button" style="colour: #D1FFFF; width:100%;" placeholder="Type here when the countdown finishes..." autofocus enhanced>
        </textarea>
</div> </div>
    </main>

    <div id="popup-overlay" class="popup-overlay">
        <div id="popup-content" class="popup-content">
            </div>
    </div>

    <script>

        let state = {
            testText: "",
            currentCharIndex: 0,
            totalErrors: 0,
            correctKeystrokes: 0,
            incorrectKeystrokes: 0,
            timerId: null,
            initialTime: 60, 
            timeLeft: 60,
            isRunning: false,
            wpmHistory: [],
            historyLabels: [],
            timeElapsed: 0,
        };


        const textDisplay = document.getElementById('typing-text-display');
        const textInput = document.getElementById('text-input');
        const modeSelect = document.getElementById('lesson-mode');
        const timeSelect = document.getElementById('time-select');
        const customTimeInput = document.getElementById('custom-time');
        const netWpmEl = document.getElementById('net-wpm');
        const accuracyEl = document.getElementById('accuracy');
        const errorsCountEl = document.getElementById('errors-count');
        const timeLeftEl = document.getElementById('time-left');
        const popupOverlay = document.getElementById('popup-overlay');
        const popupContent = document.getElementById('popup-content');
        const initialStartBtn = document.getElementById('initial-start-btn');

        
        const lineMaxChars = 40; 
        const scrollThreshold = Math.floor(lineMaxChars / 3); 


const textBank = {
    standard: "A journey of a thousand miles begins with a single step. The only way to do great work is to love what you do. Success is not final, failure is not fatal: it is the courage to continue that counts.",
    code: "function fetchData(url) { return fetch(url).then(response => response.json()).catch(error => console.error('Error fetching:', error)); }",
};


const newsBank = [
`In line with a series of hostile moves, the U.S. seized a Venezuelan oil tanker, Skipper, on December 10. Venezuela called it the latest example of Washington’s “piracy, kidnapping, theft of private property, extrajudicial executions in international waters”. The tanker was part of Venezuela’s ongoing efforts to support Cuba through subsidised oil shipments, with proceeds from resale to China providing Havana crucial revenue. For decades, Venezuela has sent oil to Cuba at highly subsidised prices, with Cuba sending doctors and security professionals to Venezuela. The seizure represents a troubling escalation in U.S. policy toward Venezuela under President Nicolás Maduro. It is also clear that the U.S. Secretary of State, Marco Rubio, a major hawk on U.S. foreign policy towards Cuba, has sought to disrupt one of the island nation’s economic lifelines. The overt moves to engineer regime change in Venezuela and other brazen acts mark a new low in U.S. foreign policy, recalling the interventionist era of its Monroe Doctrine in Latin America.`, `Thai immigration officials said they were taken into custody based on an active request from Indian law enforcement. The brothers are expected to be deported to India later today to face questioning and possible charges related to negligence and violations of safety codes. Indian officials held an emergency press conference asking for full cooperation from their Thai counterparts. Use and share with friends our Typing Speed Pro because you deserves better`,

`Nuclear power contributed only around 3% of the electricity generated in India in 2024-25. The government has set a target to install 100 GW of nuclear capacity by 2047, including from at least five indigenous small modular reactors by 2033. In this picture, the SHANTI Bill proposes to change who can legally build and operate civil nuclear facilities. By allowing the Centre to permit nuclear energy activities through licences to government entities, joint ventures and “any other company” (subject to conditions), SHANTI indicates that the intended new class of operators is domestic private capital rather than foreign plant owners. India being able to meet its 100 GW target will indeed require large capital mobilisation, and allowing licensed non-government entities expands the roster of entities that can share the construction risk. SHANTI also seeks to keep the most sensitive fuel cycles in state control while holding room for private participation in plant delivery and parts of the supply chain, reducing scope of commercial entry to those segments most relevant to scale power generation and keeping functions sensitive to nuclear proliferation with the state. The Bill could also mitigate the legal ambiguity new entrants face by putting safety, enforcement and dispute resolution and the terms of participation in the same statute. This could also reduce transaction costs for developers and shrink site approval and commissioning timelines.`,   
        
`The decision made by the Reserve Bank of India’s Monetary Policy Committee (MPC) to cut interest rates once again, by 25 basis points to 5.25%, is both an assessment of India’s current economy and also of what to expect over the next few months. Cumulatively, interest rates have been cut by 125 basis points in calendar year 2025. The last time such large cuts had been implemented was in 2019 when rates had been cut by 135 basis points, in reaction to a plummeting growth rate. India’s quarterly GDP growth rate had fallen from 8.9% in the March 2018 quarter to 3.3% by the quarter-ended December 2019. Growth is currently seeing the opposite trajectory. It has steadily been accelerating from 5.6% in Q2 of last year to the recently released 8.2% in Q2 of this year. From a growth perspective, there are at least two ways to look at the MPC’s interest rate moves. The first is that the central bank is not convinced that growth is currently as robust as the numbers suggest, and so feels monetary policy needs to be as supportive as possible. After all, it could have left rates unchanged at 5.5%. The second is that the MPC feels that Indian companies are still sitting on excess capacity, and so the risks of overheating the economy are slim. So, it might as well push for more growth. The reality is probably a combination of the two: real growth looks higher due to an unusually low deflator, and companies can certainly afford to invest more, even if this is fuelled by debt. A rate cut addresses both issues.`,      
        
`The Supreme Court’s direction to the CBI to conduct a pan-India investigation into cyber-crimes, and “digital arrest” scams in particular, might seem extraordinary, as such directions normally require State government consent. But by doing so, the Court has acknowledged the severity of the menace that transcends State jurisdictions and boundaries. The Court’s prioritisation of the “digital arrest” scam — fraudsters impersonate police or government officials in a video call, falsely accuse victims of crimes, and pressure them to transfer money to avoid arrest — is fully warranted. The government has estimated that this scam, which often targets senior citizens, has resulted in losses exceeding ₹3,000 crore. The Court has asked the CBI to target not just the scammers but also banking officials who facilitate the creation of “mule” accounts. This is necessary as these scams depend on a malleable financial architecture and therefore require the intervention of agencies such as the RBI, which has also been instructed by the Court to employ Artificial Intelligence and Machine Learning to trace the “layering” of proceeds through multiple accounts. The Court has also asked online intermediaries to cooperate with the CBI, invoking the IT Rules 2021. The Court is also right in asking the CBI to investigate other scams such as investment schemes and part-time job scams, subsequently.`,      
        
`The severity of cyber frauds, as National Crime Records Bureau data indicate, has risen significantly. However, while the judiciary and domestic policing can address the symptoms within India, the problem has another dimension — it is also transnational. The burgeoning of “scam centres” — compounds where trafficked workers, unable to escape due to violence, confiscated documents or debt bondage, are forced to run online fraud operations — in conflict-ridden zones of Southeast Asia suggests that the solution requires robust international diplomacy. The U.S., for instance, has established a Scam Center Strike Force to tackle the issue. Furthermore, Myanmar remains a hotbed for these operations, primarily because the illegally ruling junta benefits from taxing the proceeds of such crimes. Tackling this requires moving beyond bilateral requests. New Delhi must act in cohesion with ASEAN and the UN to sanction the illegal regime and cut off the financial lifelines of these modern-day slavery sweatshops. Domestically, the battle must also be fought on the grounds of digital literacy and capacity. As daily life and governance become increasingly digitised, there remains a glaring deficit in cyber awareness among the population. States, local administrations, and the RBI must launch widespread awareness campaigns. Simultaneously, there is an urgent need to upgrade the digital capabilities of State police.`,        
        ];

        const ctx = document.getElementById('wpm-chart').getContext('2d');
        const wpmChart = new Chart(ctx, {
            type: 'line',
            data: { labels: [], datasets: [{ label: 'Net WPM', data: [], borderColor: '#007bff', backgroundColor: '#007bff40', borderWidth: 2, tension: 0.4, fill: true }] },
            options: {
                responsive: true, maintainAspectRatio: false,
                scales: { y: { beginAtZero: true, title: { display: true, text: 'WPM' } }, x: { title: { display: true, text: '' } } },
                plugins: { legend: { display: false } }
            }
        });




        async function loadText() {
            const mode = modeSelect.value;
            let content;

            if (mode === 'news') {
            let currentIndex = parseInt(localStorage.getItem('newsIndex')) || 0;
                content = newsBank[currentIndex % newsBank.length];
                let nextIndex = (currentIndex + 1) % newsBank.length;
                localStorage.setItem('newsIndex', nextIndex);
            } else {
                content = textBank[mode];
            }

            
            content = content.replace(/\n/g, ' ').replace(/\s+/g, ' '); 

            state.testText = content;
            textDisplay.innerHTML = '';
            state.testText.split('').forEach((char, index) => {
                const charSpan = document.createElement('span');
                charSpan.innerHTML = char === ' ' ? '&nbsp;' : char;
                if (index === 0) {
                    charSpan.classList.add('current');
                }
                textDisplay.appendChild(charSpan);
            });
            
            textDisplay.scrollLeft = 0;
        }

        function updateMetrics() {
            state.timeElapsed = state.initialTime - state.timeLeft;
            const timeInMinutes = state.timeElapsed / 60;

            const totalKeystrokes = state.correctKeystrokes + state.incorrectKeystrokes;

            let netWPM = ((state.correctKeystrokes / 5) - state.totalErrors) / timeInMinutes;
            if (netWPM < 0 || timeInMinutes === 0) {
                netWPM = 0;
            }

            let accuracy = (totalKeystrokes > 0) ? (state.correctKeystrokes / totalKeystrokes) * 100 : 100;


            netWpmEl.textContent = Math.round(netWPM);
            accuracyEl.textContent = Math.round(accuracy);
            errorsCountEl.textContent = state.totalErrors;


            if (state.timeElapsed % 5 === 0 && state.timeElapsed > 0 && state.timeLeft > 0) {
                state.wpmHistory.push(Math.round(netWPM));
                state.historyLabels.push(state.timeElapsed);

                wpmChart.data.labels = state.historyLabels;
                wpmChart.data.datasets[0].data = state.wpmHistory;
                wpmChart.update();
            }
        }

        function updateTimer() {
            if (state.timeLeft > 0) {
                state.timeLeft--;
                timeLeftEl.textContent = state.timeLeft;
                updateMetrics();
            } else {
                clearInterval(state.timerId);
                state.isRunning = false;
                updateMetrics();
                showResultsPopup();
            }
        }

        function startTest() {
            if (state.isRunning) return;

            popupOverlay.style.display = 'none';
            state.isRunning = true;
            textInput.disabled = false;
            textInput.focus();

            
            textInput.value = ''; 

            state.timerId = setInterval(updateTimer, 1000);
        }

        function handleInput(event) {
            if (!state.isRunning) return;
            const typedValue = textInput.value;
            const targetChar = state.testText[state.currentCharIndex];
            const textSpans = textDisplay.querySelectorAll('span');

           
            if (event.inputType === 'deleteContentBackward') {
                if (state.currentCharIndex > 0) {
                    state.currentCharIndex--;
                    textSpans[state.currentCharIndex].classList.remove('correct', 'incorrect');
                    textSpans[state.currentCharIndex].classList.add('current');
                    if (textSpans[state.currentCharIndex + 1]) {
                        textSpans[state.currentCharIndex + 1].classList.remove('current');
                    }

                   
                    if (state.currentCharIndex < state.testText.length - scrollThreshold) {
                         
                        const previousCharSpan = textSpans[state.currentCharIndex - 1];
                        if (previousCharSpan) {
                            textDisplay.scrollLeft = previousCharSpan.offsetLeft - (textDisplay.offsetWidth / 3);
                        } else {
                            textDisplay.scrollLeft = 0;
                        }
                    }

                }
               
                textInput.value = typedValue.substring(0, state.currentCharIndex); 
                return;
            }

           
            if (typedValue.length > state.currentCharIndex + 1) {
                textInput.value = typedValue.substring(0, state.currentCharIndex + 1);
                return;
            }

            if (state.currentCharIndex >= state.testText.length) {
                 
                textInput.value = typedValue.substring(0, state.testText.length);
                return;
            }

            const currentTypedChar = typedValue[typedValue.length - 1];

            
            if (textSpans[state.currentCharIndex]) {
                textSpans[state.currentCharIndex].classList.remove('current');

                if (currentTypedChar === targetChar) {
                    textSpans[state.currentCharIndex].classList.add('correct');
                    state.correctKeystrokes++;
                } else {
                    textSpans[state.currentCharIndex].classList.add('incorrect');
                    state.incorrectKeystrokes++;
                    state.totalErrors++;
                }
            }


            state.currentCharIndex++;

            if (state.currentCharIndex === state.testText.length) {
                state.timeLeft = 0;
                updateTimer();
                return;
            }

            if (textSpans[state.currentCharIndex]) {
                textSpans[state.currentCharIndex].classList.add('current');
            }

           
            const currentCharSpan = textSpans[state.currentCharIndex];
            if (currentCharSpan && state.currentCharIndex > scrollThreshold) {
                const scrollPosition = currentCharSpan.offsetLeft - (textDisplay.offsetWidth / 3);
                textDisplay.scrollLeft = scrollPosition;
            }
        }


        function showResultsPopup() {

    const BACKGROUND_IMAGE_URL = 'Time.png';

    const finalWPM = netWpmEl.textContent;
    const finalAccuracy = accuracyEl.textContent;


    popupContent.innerHTML = `

        <div id="result-background" style="
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('${BACKGROUND_IMAGE_URL}'); /* Image URL use kiya */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.8; /* Image ko halka karne ke liye */
            z-index: 5; /* Background ko content se peeche rakhne ke liye */
        "></div>

        <div style="position: relative; z-index: 10; width: 100%; height: 100%; color: #333; padding: 10px;">



            <div class="result-stats" style="
                position: absolute;
                background-color: white;
                border: 3px solid;
                border-color:#129612;
                border-radius:15px;
                bottom: 6%;
                right: 10%;
                font-size: 1.2em;
                text-align: center;
                width: 25%;
            ">
                <p style="margin: 5px 0;">Net WPM: <span style="font-weight: 700; color: #5cb85c;">${finalWPM}</span></p>
                <p style="margin: 5px 0;">Accuracy: <span style="font-weight: 700; color: #5cb85c;">${finalAccuracy}%</span></p>
                <p style="margin: 5px 0;">Total Errors: <span style="font-weight: 700; color: #d9534f;">${errorsCountEl.textContent}</span></p>
            </div>

            <div class="popup-controls" style="
                position: absolute;
                bottom: 8%;
                // width: 30%;
                left: 20%;
                transform: translateX(-50%); /* Center horizontally */
            ">
                <button style="color:#14FF99; background-color:#129612;" onclick="window.location.reload()">Restart Test</button> 
                <div class="popup-time-select" style="border:3px solid #129612; border-radius: 10px; overflow:hidden;" >
                    <select id="popup-time-select">
                        <option value="60">1 Min</option>
                        <option value="180">3 Mins</option>
                        <option value="300">5 Mins</option>
                    </select>
                    <input type="number" id="popup-custom-time" min="10" max="600" value="${state.initialTime}" placeholder="Custom (s)">
                </div>
            </div>

        </div>
    `;


    
    const popupTimeSelect = document.getElementById('popup-time-select');
    const popupCustomTime = document.getElementById('popup-custom-time');

    if (popupTimeSelect.querySelector(`option[value="${state.initialTime}"]`)) {
         popupTimeSelect.value = state.initialTime;
    } else {
        popupTimeSelect.value = ''; 
    }
    popupCustomTime.value = state.initialTime;


    popupOverlay.style.display = 'flex';
    popupContent.classList.add('show');


   
}

        function startCountdown() {
            let count = 3;
            popupContent.innerHTML = `<div class="countdown-number">${count}</div>`;
            popupOverlay.style.display = 'flex';
            popupContent.classList.add('show');

            const countdownInterval = setInterval(() => {
                count--;
                if (count > 0) {
                    popupContent.innerHTML = `<div class="countdown-number">${count}</div>`;
                } else if (count === 0) {
                    popupContent.innerHTML = `<div class="countdown-number">GO!</div>`;
                } else {
                    clearInterval(countdownInterval);
                    startTest();
                }
            }, 1000);
        }



        function syncTimeAndReset() {
                        let newTimeEl = customTimeInput;
            let selectEl = timeSelect;

            let newTime = parseInt(selectEl.value);


            if (newTimeEl.value) {
                newTime = parseInt(newTimeEl.value);
            }

            if (isNaN(newTime) || newTime < 10) newTime = 60;


            timeSelect.value = newTime;
            customTimeInput.value = newTime;


            resetTest(newTime);
        }

        function resetTest(newTime) {
            clearInterval(state.timerId);

            const timeToSet = newTime || state.initialTime;

            state = {
                testText: state.testText,
                currentCharIndex: 0,
                totalErrors: 0,
                correctKeystrokes: 0,
                incorrectKeystrokes: 0,
                timerId: null,
                initialTime: timeToSet,
                timeLeft: timeToSet,
                isRunning: false,
                wpmHistory: [],
                historyLabels: [],
                timeElapsed: 0,
            };


            textInput.value = '';
            textInput.disabled = true;
            timeLeftEl.textContent = state.initialTime;
            netWpmEl.textContent = '0';
            accuracyEl.textContent = '100';
            errorsCountEl.textContent = '0';


            wpmChart.data.labels = [];
            wpmChart.data.datasets[0].data = [];
            wpmChart.update();

            popupOverlay.style.display = 'none';

            loadText();
        }

        textInput.addEventListener('input', handleInput);
        initialStartBtn.addEventListener('click', () => {
             syncTimeAndReset();
             startCountdown();
        });


        modeSelect.addEventListener('change', syncTimeAndReset);
        timeSelect.addEventListener('change', syncTimeAndReset);
        customTimeInput.addEventListener('change', syncTimeAndReset);


        syncTimeAndReset();
    </script>
</body>
</html>