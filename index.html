<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Speed Pro</title>
    <link rel="icon" type="jpg" href="icon.jpg">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>

.gradient-border-wrapper {
    position: relative;
    display: inline-block;
    padding: 5px;
    border-radius: 9999px;

    background: transparent;
    overflow: hidden;
}

.border-wrapper {
    position: relative;
    display: flex;
    padding: 3px;
    border-radius: 10px;
    background: transparent;
    overflow: hidden;
    width:100%;
}



.gradient-border-wrapper::before {
    content: "";
    position: absolute;
    right: -17px;
    top: -38px;
    insert: -50%;
    width: 150px;
    height: 150px;
    background: conic-gradient(
        #4285f4,
        #ea4335,
        #fbbc05,
        #34a853,
        #4285f4
    );
    animation: google-ring-spin 3s linear infinite;
}


.border-wrapper::before {
    content: "";
    position: absolute;
    right: -15%;
    top: -470px;
    insert: -50%;
    width: 130%;
    height: 700%;
    background: conic-gradient(
        #4285f4,
        #ea4335,
        #fbbc05,
        #34a853,
        #4285f4
    );
    animation: google-ring-spin 3s linear infinite;
}
.gradient-border-wrapper .inner-button {
    position: relative;
    z-index: 1;
    border: none;
    border-radius: 999px;
    padding: 10px 26px;
    background: #111;
    color: #fff;
    font-size: 1rem;
    cursor: pointer;
}


@keyframes google-ring-spin {
    0%   { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}


.border-wrapper .inner-button {
    position: relative;
    z-index: 1;
    border: none;
    border-radius: 10px;
    padding: 60px;
    background: #D1FFFF;
    color: black;
    font-size: 1.4em;
    cursor: pointer;
}


@keyframes google-ring-spin {
    0%   { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}


            body {
            font-family: 'Poppins', sans-serif;
            background-color: #424242;
            color: #333;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }




 .glow header {
            width: 85%;
            z-index: 2;
            text-align: center;
            border-radius: 12px;
            padding: 20px 0;
            background-color: #007bff;
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h1 { margin: 0; font-weight: 600; }

.glow {
    position: relative;
    display: inline-block;
    padding: 5px;
    border-radius: 9999px;

    background: transparent;
    overflow: hidden;
}

.glow::before {
    content: "";
    position: absolute;
    right: -670px;
    top: -190px;
    insert: -50%;
    width: 2700px;
    height: 2700px;
    background: conic-gradient(
        #4285f4,
        #ea4335,
        #fbbc05,
        #34a853,
        #4285f4
    );
    animation: google-ring-spin 3s linear infinite;
}
  .glow {
            display: flex;
            flex-direction: column;
            width: 100%;
            justify-content: center;
            align-items: center;
            margin-top: 0px;
            padding: 0px;
            background-color: red;
            border-radius: 0px;
            position: relative;
        }



        .container {
            width: 90%;
            max-width: 1100px;
            margin-top: 30px;
            margin-bottom: 30px;
            padding: 20px;
            background-color: #E3E3E3;
            border-radius: 12px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
            position: relative;
        }
       .stats-panel {
            display: flex;
            justify-content: space-around;
            background-color: #A6D2FF;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 1.1em;
            font-weight: 500;
            border-left: 5px solid #007bff;
        }
        .stats-panel p { margin: 0; }
        .stats-panel span { font-weight: 700; color: #d9534f; }
        #net-wpm, #accuracy { color: #5cb85c; }


        .graph-container {
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 20px;
            height: 350px;
            background-color:#A6D2FF;
        }


        .typing-text-display {
            background-color: #ADFF5C;
            padding: 25px;
            border-radius: 8px;
            font-size: 1.4em;
            line-height: 1.8;
            margin-bottom: 20px;
            min-height: 120px;
            border: 2px solid #ccc;
            user-select: none;
        }


        .correct { color: #5cb85c; }
        .incorrect {
            background-color: #f2dede;
            color: #a94442;
            border-bottom: 1px dashed #a94442;
        }
        .current {
            background-color: #007bff40;
            border-right: 2px solid #007bff;
            animation: blink 1s step-start 0s infinite;
        }
        @keyframes blink { 50% { border-right-color: transparent; } }


        .text-input {
            width: 100%;
            height: 100px;
            padding: 15px;
            border: 2px solid #007bff;
            border-radius: 8px;
            font-size: 1.4em;
            resize: none;
            background-color: #A6D2FF;
            color: #333;
            box-sizing: border-box;
            outline: none;
            margin-bottom: 20px;
            transition: box-shadow 0.3s;
        }
        .text-input:focus { box-shadow: 0 0 10px rgba(0, 123, 255, 0.5); }

        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .controls select, .controls input[type="number"] {
            padding: 10px 18px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 1em;
            background-color: #A6D2FF;
            color: #333;
        }


        .loading-text { color: #007bff; font-style: italic; }


        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .popup-content {
            background: white;
            padding: 0px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 15px 25px rgba(0, 0, 0, 0.5);
            max-width: 90%;
            width: 746px;
            height: 430px;
            position: relative;
            overflow:hidden;
            transform: scale(0.9);
            transition: transform 0.3s ease-out;
        }
        .popup-content.show {
            transform: scale(1);
        }


        .popup-content h2 { color: #d9534f; font-size: 2.5em; margin-top: 0; }
        .popup-content .result-stats p { font-size: 1.2em; font-weight: 500; }
        .popup-content .result-stats span { font-weight: 700; color: #007bff; }
        .popup-content img { width: 80px; height: 80px; margin-bottom: 20px; }


        .countdown-number {
            font-size: 10em;
            font-weight: 900;
            color: #5cb85c;
            animation: pulse 1s ease-in-out infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 0.8; }
        }

        .popup-controls {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .popup-controls button {
            background-color: #5cb85c;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .popup-controls button:hover {
            background-color: #449d44;
        }
        .popup-time-select {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        .popup-time-select select, .popup-time-select input {
             padding: 8px;
             border: 1px solid #ced4da;
             border-radius: 5px;
        }
    </style>
</head>
<body>



    <main class="glow" style="colour: blue;">

    <header>
        <h1>Typing Speed Pro</h1>
    </header>

<div class="container">
        <div class="stats-panel">
            <p>Net Speed: <span id="net-wpm">0</span> WPM</p>
            <p>Accuracy: <span id="accuracy">100</span>%</p>
            <p>Errors: <span id="errors-count">0</span></p>
            <p>Time Left: <span id="time-left">60</span>s</p>
        </div>

        <div class="graph-container">
            <h3>WPM Consistency (Per 5 seconds)</h3>
            <canvas id="wpm-chart"></canvas>
        </div>

        <div id="initial-controls" class="controls">
            <select id="time-select">
                <option value="60">1 Minute</option>
                <option value="180">3 Minutes</option>
                <option value="300">5 Minutes</option>
                </select>
            <input type="number" id="custom-time" min="10" max="600" value="60" placeholder="Custom Time (s)">

            <select id="lesson-mode">
                <option value="news">Dynamic News (Recommended)</option>
                <option value="standard">Static Paragraph</option>
                <option value="code">Code Syntax</option>
            </select>
     <div class="gradient-border-wrapper">
  <button <button id="initial-start-btn" class="inner-button" style="background-color: black;
   ">Start Test</button> </div>


</div>
        <div id="typing-text-display" class="typing-text-display loading-text">
            Loading Fresh Content... Please wait.
        </div>




<div class="border-wrapper">
        <textarea id="text-input" class="inner-button" style="colour: #D1FFFF; width:100%;" placeholder="Type here when the countdown finishes..." autofocus enhanced>
        </textarea>
</div> </div>
    </main>

    <div id="popup-overlay" class="popup-overlay">
        <div id="popup-content" class="popup-content">
            </div>
    </div>

    <script>

        let state = {
            testText: "",
            currentCharIndex: 0,
            totalErrors: 0,
            correctKeystrokes: 0,
            incorrectKeystrokes: 0,
            timerId: null,
            initialTime: 60,
            timeLeft: 60,
            isRunning: false,
            wpmHistory: [],
            historyLabels: [],
            timeElapsed: 0,
        };


        const textDisplay = document.getElementById('typing-text-display');
        const textInput = document.getElementById('text-input');
        const modeSelect = document.getElementById('lesson-mode');
        const timeSelect = document.getElementById('time-select');
        const customTimeInput = document.getElementById('custom-time');
        const netWpmEl = document.getElementById('net-wpm');
        const accuracyEl = document.getElementById('accuracy');
        const errorsCountEl = document.getElementById('errors-count');
        const timeLeftEl = document.getElementById('time-left');
        const popupOverlay = document.getElementById('popup-overlay');
        const popupContent = document.getElementById('popup-content');
        const initialStartBtn = document.getElementById('initial-start-btn');


const textBank = {
    standard: "A journey of a thousand miles begins with a single step. The only way to do great work is to love what you do. Success is not final, failure is not fatal: it is the courage to continue that counts.",
    code: "function fetchData(url) { return fetch(url).then(response => response.json()).catch(error => console.error('Error fetching:', error)); }",
};


const newsBank = [
`The tragic fire at a popular nightclub in Goa has remained at the top of national headlines. On December 11 2025 authorities confirmed that twenty five people lost their lives in the blaze that broke out late at night when the club was crowded with patrons. The fire safety audit of the nightclub was under scrutiny as investigators worked through the night to reconstruct how the blaze began and spread so rapidly. Two brothers who owned and operated the nightclub were detained in Thailand early today.`,

`Thai immigration officials said they were taken into custody based on an active request from Indian law enforcement. The brothers are expected to be deported to India later today to face questioning and possible charges related to negligence and violations of safety codes. Indian officials held an emergency press conference asking for full cooperation from their Thai counterparts. Use and share with friends our Typing Speed Pro because you deserves better`,

`Families of the victims expressed grief and anger at the slow pace of rescue efforts and demanded stricter enforcement of safety regulations in entertainment venues. Medical teams continued to treat burn victims in hospitals across Goa. The national government said it will cover medical expenses and provide support to the families of those who died and those still recovering in hospital. Use and share with friends our Typing Speed Pro because you deserves better`,

`Prime Minister Narendra Modi announced that he will undertake a diplomatic tour from December fifteen to December eighteen this year. The itinerary includes official visits to Jordan Ethiopia and Oman. In each country the prime minister is expected to discuss bilateral cooperation in areas such as energy water resources and trade. In Jordan he will meet with the king to strengthen relations and reaffirm partnership on regional stability.`,

`In Ethiopia the focus will be on development aid agricultural technology and support for infrastructure projects. In Oman discussions will primarily center on maritime security and expanding economic ties. Senior government officials said that this tour reflects Indias commitment to engagement with West Asia and Africa. Preparations for the visits were finalized after months of consultation with ministries involved in foreign trade and defense. Use and share with friends our Typing Speed Pro because you deserves better`,

`The prime ministers office released a statement saying the visits are part of efforts to boost economic growth and strengthen Indias global footprint. The announcement has been welcomed by business communities looking to expand exports to these regions. Each stop on the tour includes cultural events to build people to people ties. Indian expatriates in those countries have also expressed anticipation for the leaders visit. Use and share with friends our Typing Speed Pro because you deserves better`,

`World leaders and diplomats continued efforts to find a negotiated peace in the ongoing war in Eastern Europe. On December 11 representatives of Ukraine submitted an updated peace proposal to Western allies including the United States. The new plan is said to contain around twenty points aimed at addressing key issues such as territorial security economic reconstruction and international guarantees. Use and share with friends our Typing Speed Pro because you deserves better`,

`Ukrainian officials stated that they want a ceasefire followed by phased disengagement of forces. Western diplomats praised the updated approach while stressing that talks remain difficult and that Russia must agree to meaningful concessions. The United States reiterated its support for Ukraine while urging all parties to avoid further escalation. Global markets watched the developments closely as the conflict has broad implications for energy prices and regional stability. Analysts said that any progress in peace negotiations could stabilize markets that have been volatile due to uncertainty.`,

`Meanwhile humanitarian groups continued their work providing aid to civilians affected by the conflict. The United Nations called on all sides to protect civilians and ensure safe passage for aid deliveries. The peace plan submission has renewed hope among citizens weary of years of conflict. International observers reminded the world that durable peace will require sustained diplomacy not just a single agreement. Use and share with friends our Typing Speed Pro because you deserves better`,

`The United States Federal Reserve announced a cut in benchmark interest rates this week as part of its ongoing effort to support slowing economic growth and bring inflation closer to target levels. The decision was widely anticipated by investors and economists who had seen recent data showing softening demand and uneven job gains. Use and share with friends our Typing Speed Pro because you deserves better`,

`Following the announcement global equity markets showed a mixed reaction with some indices rallying on optimism for cheaper borrowing costs and others retreating due to lingering concerns about corporate earnings. Emerging market currencies in Latin America strengthened against the dollar as capital flows responded to the rate cut. Analysts said that lower interest rates could ease pressure on developing economies that are struggling with high debt costs. At the same time many central bankers around the world said they are watching inflation trends carefully before making any further moves. Business leaders reacted by adjusting forecasts and revising investment strategies based on expected credit conditions.`,

`Consumers were also affected as lower rates could translate to cheaper loans for homes and vehicles. Critics of the policy said the cut might come too late for some sectors facing structural challenges. Overall the markets and policymakers continue to balance the dual goals of promoting growth while avoiding overheating in key industries. Use and share with friends our Typing Speed Pro because you deserves better`,

`Authorities at the National Gallery of Modern Art inaugurated a new major exhibition titled Ghika A Journey to India on December 11. The exhibit showcases a comprehensive collection of works by the esteemed artist who is known for bridging artistic traditions from his home country and his adopted home of India. Curators emphasized the cultural dialogue reflected in the paintings which span across decades of the artists evolution.`,

`The opening ceremony featured speeches by prominent art scholars and diplomats who noted the significance of cross cultural artistic exchange in todays globalized world. Visitors were moved by the vivid portrayals of Indian landscapes and daily life that reflect both nostalgia and modern artistic vision. The exhibition is expected to attract thousands of art lovers from across the country and abroad during its run.`,

`Educational programs and workshops have been planned to engage students and emerging artists in discussions about technique and influence. Museum officials stated that this exhibit aligns with efforts to make modern art more accessible to the public. Critics writing in national publications have given positive early reviews on the show. Local schools are arranging field trips to the gallery to introduce younger audiences to varied artistic styles.`,

`Regional weather authorities issued a series of alerts due to unusual climate patterns seen this season. In parts of southern and eastern regions meteorologists reported unseasonably heavy rainfall leading to flood warnings in low lying areas. Emergency services and local governments activated response teams to assist residents with evacuations and sandbagging efforts. Use and share with friends our Typing Speed Pro because you deserves better`,

`Transportation departments warned of disruptions on major highways and advised travelers to plan alternative routes. Farmers expressed concern about crop damage as fields became inundated with water that could delay harvests. State health officials reminded the public about the risks of waterborne diseases that can follow flooding and urged precautions such as purifying drinking water. Schools in the most affected districts announced temporary closures to ensure student safety. Municipal authorities are coordinating with relief agencies to set up shelters and distribute essential supplies.`,

`A series of briefings kept citizens updated on changing conditions as weather models predicted more rain in the coming week. Climate scientists commented that such patterns of intense rainfall are consistent with shifting climate trends observed globally. Residents shared images on social media showing inundated streets and community efforts to keep homes clear of water damage. Use and share with friends our Typing Speed Pro because you deserves better`,

`World diplomatic forums have seen renewed calls for cooperation on several geopolitical flashpoints. On December 11 representatives from multiple nations met to discuss pressing issues including border disputes trade barriers and humanitarian access in troubled regions. Delegates emphasized the importance of upholding international law and protecting human rights in all negotiations. Use and share with friends our Typing Speed Pro because you deserves better`,

`Several speeches highlighted the need for sustained economic cooperation to ensure global stability during times of uncertainty. Diplomats also discussed ongoing conflicts and the importance of creating safe corridors for civilians. The meeting included updates on refugee flows and strategies for improving support services in host countries. Trade officials and economic leaders shared insights about reducing barriers while balancing national interests. Many attending envoys noted that cooperation rather than confrontation is essential for addressing the complex issues facing the world.`,

`Joint statements were prepared outlining shared objectives but also acknowledging areas where consensus remains difficult. The forums concluded with commitments to reconvene later in the year for further consultations. Participants expressed optimism that dialogue remains the path forward for resolving many of the challenges confronting the global community. Use and share with friends our Typing Speed Pro because you deserves better`
];

        const ctx = document.getElementById('wpm-chart').getContext('2d');
        const wpmChart = new Chart(ctx, {
            type: 'line',
            data: { labels: [], datasets: [{ label: 'Net WPM', data: [], borderColor: '#007bff', backgroundColor: '#007bff40', borderWidth: 2, tension: 0.4, fill: true }] },
            options: {
                responsive: true, maintainAspectRatio: false,
                scales: { y: { beginAtZero: true, title: { display: true, text: 'WPM' } }, x: { title: { display: true, text: '' } } },
                plugins: { legend: { display: false } }
            }
        });




        async function loadText() {
            const mode = modeSelect.value;
            let content;

            if (mode === 'news') {
            let currentIndex = parseInt(localStorage.getItem('newsIndex')) || 0;
                content = newsBank[currentIndex % newsBank.length];
                let nextIndex = (currentIndex + 1) % newsBank.length;
                localStorage.setItem('newsIndex', nextIndex);
            } else {
                content = textBank[mode];
            }

            state.testText = content;
            textDisplay.innerHTML = '';
            state.testText.split('').forEach((char, index) => {
                const charSpan = document.createElement('span');
                charSpan.textContent = char;
                if (index === 0) {
                    charSpan.classList.add('current');
                }
                textDisplay.appendChild(charSpan);
            });
        }

        function updateMetrics() {
            state.timeElapsed = state.initialTime - state.timeLeft;
            const timeInMinutes = state.timeElapsed / 60;

            const totalKeystrokes = state.correctKeystrokes + state.incorrectKeystrokes;

            let netWPM = ((state.correctKeystrokes / 5) - state.totalErrors) / timeInMinutes;
            if (netWPM < 0 || timeInMinutes === 0) {
                netWPM = 0;
            }

            let accuracy = (totalKeystrokes > 0) ? (state.correctKeystrokes / totalKeystrokes) * 100 : 100;


            netWpmEl.textContent = Math.round(netWPM);
            accuracyEl.textContent = Math.round(accuracy);
            errorsCountEl.textContent = state.totalErrors;


            if (state.timeElapsed % 5 === 0 && state.timeElapsed > 0 && state.timeLeft > 0) {
                state.wpmHistory.push(Math.round(netWPM));
                state.historyLabels.push(state.timeElapsed);

                wpmChart.data.labels = state.historyLabels;
                wpmChart.data.datasets[0].data = state.wpmHistory;
                wpmChart.update();
            }
        }

        function updateTimer() {
            if (state.timeLeft > 0) {
                state.timeLeft--;
                timeLeftEl.textContent = state.timeLeft;
                updateMetrics();
            } else {
                clearInterval(state.timerId);
                state.isRunning = false;
                updateMetrics();
                showResultsPopup();
            }
        }

        function startTest() {
            if (state.isRunning) return;

            popupOverlay.style.display = 'none';
            state.isRunning = true;
            textInput.disabled = false;
            textInput.focus();


            state.timerId = setInterval(updateTimer, 1000);
        }

        function handleInput(event) {
            if (!state.isRunning) return;
            const typedValue = textInput.value;
            const currentTypedChar = typedValue[typedValue.length - 1];
            const targetChar = state.testText[state.currentCharIndex];
            const textSpans = textDisplay.querySelectorAll('span');

            if (event.inputType === 'deleteContentBackward') {
                if (state.currentCharIndex > 0) {
                    state.currentCharIndex--;
                    textSpans[state.currentCharIndex].classList.remove('correct', 'incorrect');
                    textSpans[state.currentCharIndex].classList.add('current');
                    if (textSpans[state.currentCharIndex + 1]) {
                        textSpans[state.currentCharIndex + 1].classList.remove('current');
                    }
                }
                return;
            }

            if (state.currentCharIndex >= state.testText.length) {
                return;
            }

            textSpans[state.currentCharIndex].classList.remove('current');

            if (currentTypedChar === targetChar) {
                textSpans[state.currentCharIndex].classList.add('correct');
                state.correctKeystrokes++;
            } else {
                textSpans[state.currentCharIndex].classList.add('incorrect');
                state.incorrectKeystrokes++;
                state.totalErrors++;
            }

            state.currentCharIndex++;

            if (state.currentCharIndex === state.testText.length) {
                state.timeLeft = 0;
                updateTimer();
                return;
            }

            if (textSpans[state.currentCharIndex]) {
                textSpans[state.currentCharIndex].classList.add('current');
            }
        }



     function showResultsPopup() {

    const BACKGROUND_IMAGE_URL = 'Time.png';

    const finalWPM = netWpmEl.textContent;
    const finalAccuracy = accuracyEl.textContent;


    popupContent.innerHTML = `

        <div id="result-background" style="
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('${BACKGROUND_IMAGE_URL}'); /* Image URL use kiya */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.8; /* Image ko halka karne ke liye */
            z-index: 5; /* Background ko content se peeche rakhne ke liye */
        "></div>

        <div style="position: relative; z-index: 10; width: 100%; height: 100%; color: #333; padding: 10px;">



            <div class="result-stats" style="
                position: absolute;
                background-color: white;
                border: 3px solid;
                border-color:#129612;
                border-radius:15px;
                bottom: 6%;
                right: 10%;
                font-size: 1.2em;
                text-align: center;
                width: 25%;
            ">
                <p style="margin: 5px 0;">Net WPM: <span style="font-weight: 700; color: #5cb85c;">${finalWPM}</span></p>
                <p style="margin: 5px 0;">Accuracy: <span style="font-weight: 700; color: #5cb85c;">${finalAccuracy}%</span></p>
                <p style="margin: 5px 0;">Total Errors: <span style="font-weight: 700; color: #d9534f;">${errorsCountEl.textContent}</span></p>
            </div>

            <div class="popup-controls" style="
                position: absolute;
                bottom: 8%;
                // width: 30%;
                left: 20%;
                transform: translateX(-50%); /* Center horizontally */
            ">
                <button style="color:#14FF99; background-color:#129612;" onclick="startCountdown()">Restart Test</button>
                <div class="popup-time-select" style="border:3px solid #129612; border-radius: 10px; overflow:hidden;" >
                    <select id="popup-time-select">
                        <option value="60">1 Min</option>
                        <option value="180">3 Mins</option>
                        <option value="300">5 Mins</option>
                    </select>
                    <input type="number" id="popup-custom-time" min="10" max="600" value="${state.initialTime}" placeholder="Custom (s)">
                </div>
            </div>

        </div>
    `;





    document.getElementById('popup-time-select').value = state.initialTime;
    document.getElementById('popup-custom-time').value = state.initialTime;

    popupOverlay.style.display = 'flex';
    popupContent.classList.add('show');


    document.getElementById('popup-time-select').addEventListener('change', syncTimeAndReset);
    document.getElementById('popup-custom-time').addEventListener('change', syncTimeAndReset);
}

        function startCountdown() {
            let count = 3;
            popupContent.innerHTML = `<div class="countdown-number">${count}</div>`;
            popupOverlay.style.display = 'flex';
            popupContent.classList.add('show');

            const countdownInterval = setInterval(() => {
                count--;
                if (count > 0) {
                    popupContent.innerHTML = `<div class="countdown-number">${count}</div>`;
                } else if (count === 0) {
                    popupContent.innerHTML = `<div class="countdown-number">GO!</div>`;
                } else {
                    clearInterval(countdownInterval);
                    startTest();
                }
            }, 1000);
        }



        function syncTimeAndReset() {
                         let newTimeEl = document.getElementById('popup-custom-time') || customTimeInput;
            let selectEl = document.getElementById('popup-time-select') || timeSelect;

            let newTime = parseInt(selectEl.value);


            if (newTimeEl.value) {
                newTime = parseInt(newTimeEl.value);
            }

            if (isNaN(newTime) || newTime < 10) newTime = 60;


            timeSelect.value = newTime;
            customTimeInput.value = newTime;
            if (document.getElementById('popup-time-select')) {
                 document.getElementById('popup-time-select').value = newTime;
                 document.getElementById('popup-custom-time').value = newTime;
            }

            resetTest(newTime);
        }

        function resetTest(newTime) {
            clearInterval(state.timerId);

            const timeToSet = newTime || state.initialTime;

            state = {
                testText: state.testText,
                currentCharIndex: 0,
                totalErrors: 0,
                correctKeystrokes: 0,
                incorrectKeystrokes: 0,
                timerId: null,
                initialTime: timeToSet,
                timeLeft: timeToSet,
                isRunning: false,
                wpmHistory: [],
                historyLabels: [],
                timeElapsed: 0,
            };


            textInput.value = '';
            textInput.disabled = true;
            timeLeftEl.textContent = state.initialTime;
            netWpmEl.textContent = '0';
            accuracyEl.textContent = '100';
            errorsCountEl.textContent = '0';


            wpmChart.data.labels = [];
            wpmChart.data.datasets[0].data = [];
            wpmChart.update();

            popupOverlay.style.display = 'none';

            loadText();
        }

        textInput.addEventListener('input', handleInput);
        initialStartBtn.addEventListener('click', () => {
             syncTimeAndReset();
             startCountdown();
        });


        modeSelect.addEventListener('change', syncTimeAndReset);
        timeSelect.addEventListener('change', syncTimeAndReset);
        customTimeInput.addEventListener('change', syncTimeAndReset);


        syncTimeAndReset();
    </script>
</body>
</html>
